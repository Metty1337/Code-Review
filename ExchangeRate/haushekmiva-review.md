# Review на реализацию от [@haushekmiva](https://github.com/haushekmiva) проекта [Обмен валют](https://zhukovsd.github.io/java-backend-learning-course/projects/currency-exchange/)

[Сама реализация](https://github.com/haushekmiva/currency-exchange)

## Реализация REST API

Привет, давай сначала пройдемся по твоей реализации.

### Плюсы

- Хорошая валидация на добавление новой валюты.
- Правильная форма ответа у ендпоинтов в соответствии ТЗ.

## По коду

### package controller

- Класс _ContextListener_:
    - Молодец, что используешь _ContextListener_ для управления зависимостями, но место ему явно не в пакете
      _controller_, как вариант - пакет _listener_.
    - Название _ContextListener_ слишком общее - лучше _ApplicationContextListener_ или _AppStartupListener_.

- Класс _CorsFilter_ сам по себе необязателен, ведь _CORS_ нужен только при кросс-доменных запросах, и получается, что
  ненужный фильтр создает лишние операции.
- Даже если мы оставляем _CorsFilter_, то он вместе с _ErrorHandlingFilter_ должен находиться в соответствующем пакете -
  _filter_.
- Предпочтительнее не импортировать статические методы, ради ясности источника зависимости - относится ко всем классам.

```
//вместо
sendResponse(response, currencies, HttpServletResponse.SC_OK);

// лучше
ResponseSender.sendResponse(response, currencies, HttpServletResponse.SC_OK);
```

- Класс _ErrorHandlingFilter_:
    - Логировать лучше все таки через логгер, а не через `System.err.println`
    - Ловить _Throwable_ слишком широко, ведь он включает и _Error_, что обычно не нужно. Лучше ловить _Exception_.

- Сервлеты в целом ок.

### package service

- Класс CurrencyService:
    - В методе _addCurrency_ хотелось бы все таки передавать в дао слой не три отдельные строки, а модель.
    - Метод _addCurrency_ возвращает _Currency_, что нормально для REST, но делает класс более зависимым от REST. Более
      чистой архитектурой было бы сделать два отдельных метода - один сохраняет, а другой возвращает. То же самое
      относится и к _ExchangeRateService_.
- Класс _ExchangeRateService_:
    - `private final CurrencyDao currencyDao` - сервис не должен напрямую использовать DAO другого сервиса, если уже
      есть существующий сервис, который инкапсулирует работу с этим DAO.
    - Стандартный стиль большинства Java-проектов - публичные методы стоят сверху, приватные снизу. Таким образом, когда
      кто-то открывает класс - он сразу видит публичный _API_, а детали реализации скрыты ниже.
    - То же самое, что и в _addCurrency_ - в _DAO_ лучше передавать модель.
    - Стоит не допускать _TODO_ в продакшен код.
    - Комментарии - признак плохого кода, лучше переписать код, сделав его более читабельным и понятным, чем ссорить
      комментариями. Относится ко всему проекту.
    - Некоторые методы получились довольно объемными - оттого плохо читабельными. Стоит сделать код проще,
      воспользовавшись вспомогательными методами.

### package dto

- Сейчас _Currency_ используется и как модель и как DTO, из-за чего происходит смешение ответственности. В случае чего -
  изменения _API_ тянут за собой изменение модели. То же самое относится к _ExchangeRate_.
- Как вариант улучшения - использовать _BigDecimal_ вместо _double_ для курса.

### package dao

- Как уже упоминалось - будет лучше если _DAO_ слой принимает в себя модель
- Наличие интерфейсов - большой плюс.
- Более классическое название метода _DAO_, который сохраняет данные это _save_.
- То же самое, что и у сервиса - зависимость от _REST_.
- Как вариант упрощения - вынести во вспомогательный метод извлечение и маппинг курса.
- Странное сообщение при обработке _SQLException_ - ты уже обрабатываешь эту проблему в сервисе через _Optional_.

```
catch (SQLException e) {
String message = String.format("Currency %s not found.", code);
            throw new DataAccessException(message, e);
```

- Опечатки в названиях класса - _Jbdc_, вместо _Jdbc_.
- Вместо `SELECT *` лучше конкретно прописать запрашиваемые столбцы, иначе легко ломается при изменении схемы.
- Для логгирования использовать логгер, а не `System.out.println(e.getMessage());`
- Такое же неверное сообщение в _update_ при ловле _SQLException_.

```
catch (SQLException e) {
            String message = String.format("Exchange rate for pair %d/%d not found.", baseCurrencyId, targetCurrencyId);
            throw new DataAccessException(message, e);
```

- _ResourceNotFoundException_ - исключение, относящееся к бизнес-логике. Как вариант - возвращать в сервис кол-во
  обновленных строк.
- _SQL_ можно вынести в константы, что улучшит читабельность.

### package extractors

- Классы являются утилитарными - значит должны иметь _final_ модификатор и приватный конструктор.
- Имя _InputExtractor_ слишком общее, лучше подойдет _RequestParameterExtractor_.
- Два разных контракта обработки ошибок - ты и сам знаешь, судя по комментарию.

### package utils

- Несоответствие названия у _ExchangeRateCreator_. Класс выполняет роль маппера, значит и название _ExchangeRateMapper_
  будет лучше.
- Класс _ResponseSender_ в отличие от остальных не имеет final модификатора и private конструктора.

### package validation

- Утилитарные классы без final модификатора и private конструктора.

## Общие рекомендации

- В проекте встречаются магические цифры/строки - стоит вынести в константы.
- Много комментариев - можешь отдельно почитать почему это плохо - _Мартин_, _"Чистый Код"_, гл.4, _Комментарии_
- Разделить модель и DTO.
- Советую использовать логгер и BigDecimal.
- Хорошо будет сделать некоторые методы короче, убрать перегруженность и TODO.
- Рекомендую разрабатывать дальнейшие проекты на _LTS_ версиях _java_.
- Делать имена коммитов в соответствии со [стандартом](https://gist.github.com/qoomon/5dfcdf8eec66a051ecd85625518cfd13).
- Для деплоя переименовывай war артефакт, чтобы он был всяких версий, сейчас выглядит немного некрасиво - _currency-exchange-1.0-SNAPSHOT_.
- Глянь как правильно называть корневой пакет, сейчас у тебя просто _java/controller... etc_.

# Итоги
- Достойный проект, есть над чем поработать.
- После рефакторинга считаю можно переходить к следующим проектам. Успехов!